# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ —É—á–µ–Ω–∏–∫–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–æ–º (LEARNER —Ä–æ–ª—å):
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω–æ–µ –æ–∫–Ω–æ Telegram "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞"
- –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ (–∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç)
- –û—Ç–≤–µ—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- Submission –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

## –ü—Ä–∏—á–∏–Ω—ã

### 1. Backend –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª —Å—Ç–∞—Ç—É—Å enrollment
Frontend –Ω–µ –º–æ–≥ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ—Ç–∫—Ä—ã—Ç –ª–∏ –º–æ–¥—É–ª—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.

### 2. –ü–ª–æ—Ö–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ frontend
- –î–≤–æ–π–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã (—á–µ—Ä–µ–∑ `setError` –∏ `Telegram.WebApp.showAlert`)
- –ù–µ—è—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ù–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥—É–ª—è

### 3. –í–æ–∑–º–æ–∂–Ω—ã–µ backend –æ—à–∏–±–∫–∏
- **403 Forbidden:** –ú–æ–¥—É–ª—å –Ω–µ –æ—Ç–∫—Ä—ã—Ç (`enrollment.status !== 'IN_PROGRESS'`)
- **400 Bad Request:** –£–∂–µ –µ—Å—Ç—å submission –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞
- **404 Not Found:** –®–∞–≥ –∏–ª–∏ –º–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

## –†–µ—à–µ–Ω–∏–µ

### Backend: –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å enrollment –≤ –æ—Ç–≤–µ—Ç

**1. CourseService.getStepWithProgress()** ‚Äî —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç enrollment:

```typescript
// –ü–æ–ª—É—á–∞–µ–º enrollment –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è
const enrollment = await this.prisma.enrollment.findFirst({
  where: {
    userId,
    moduleId: step.moduleId,
  },
});

return {
  // ... –ø–æ–ª—è —à–∞–≥–∞
  module: {
    id: step.module.id,
    title: step.module.title,
    enrollment: enrollment
      ? {
          id: enrollment.id,
          status: enrollment.status, // IN_PROGRESS | COMPLETED | LOCKED
        }
      : undefined,
  },
  submission: submission
    ? {
        id: submission.id,
        status: submission.status,
        answerText: submission.answerText, // –î–û–ë–ê–í–õ–ï–ù–û –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        aiScore: submission.aiScore,
        aiFeedback: submission.aiFeedback, // –î–û–ë–ê–í–õ–ï–ù–û
        curatorScore: submission.curatorScore,
        curatorFeedback: submission.curatorFeedback, // –î–û–ë–ê–í–õ–ï–ù–û
        createdAt: submission.createdAt,
      }
    : undefined,
};
```

**2. StepWithProgressDto** ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞:

```typescript
export class StepWithProgressDto extends StepResponseDto {
  module: {
    id: string;
    title: string;
    enrollment?: {
      id: string;
      status: 'IN_PROGRESS' | 'COMPLETED' | 'LOCKED';
    };
  };
  
  submission?: {
    id: string;
    status: 'SENT' | 'AI_REVIEWED' | 'CURATOR_APPROVED' | 'CURATOR_RETURNED';
    answerText?: string; // –î–û–ë–ê–í–õ–ï–ù–û
    aiScore?: number;
    aiFeedback?: string; // –î–û–ë–ê–í–õ–ï–ù–û
    curatorScore?: number;
    curatorFeedback?: string; // –î–û–ë–ê–í–õ–ï–ù–û
    createdAt: Date;
  };
}
```

### Frontend: –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**1. –û–±–Ω–æ–≤–ª—ë–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Step:**

```typescript
interface Step {
  // ... –ø–æ–ª—è —à–∞–≥–∞
  module: {
    id: string;
    enrollment?: {
      id: string;
      status: 'IN_PROGRESS' | 'COMPLETED' | 'LOCKED';
    };
  };
  submission?: {
    id: string;
    status: string;
    answerText?: string; // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    aiScore?: number;
    aiFeedback?: string;
    curatorScore?: number;
    curatorFeedback?: string;
  };
}
```

**2. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:**

```typescript
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥—É–ª—è
if (!step.module.enrollment || step.module.enrollment.status !== 'IN_PROGRESS') {
  const message = '–ú–æ–¥—É–ª—å –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–º. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥—É–ª—è –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.';
  setError(message);
  if (window.Telegram?.WebApp) {
    window.Telegram.WebApp.showAlert(`‚ö†Ô∏è ${message}`);
  }
  return;
}

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
if (step.submission && step.submission.status !== 'CURATOR_RETURNED') {
  const message = '–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É—Ä–∞—Ç–æ—Ä–∞.';
  setError(message);
  if (window.Telegram?.WebApp) {
    window.Telegram.WebApp.showAlert(`‚ÑπÔ∏è ${message}`);
  }
  return;
}
```

**3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

```typescript
catch (err: any) {
  let errorMessage = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
  
  if (err.response) {
    if (err.response.data?.message) {
      errorMessage = Array.isArray(err.response.data.message)
        ? err.response.data.message.join('; ')
        : err.response.data.message;
    } else if (err.response.status === 400) {
      errorMessage = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π.';
    } else if (err.response.status === 403) {
      errorMessage = '–ú–æ–¥—É–ª—å –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–º. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥—É–ª—è.';
    } else if (err.response.status === 404) {
      errorMessage = '–®–∞–≥ –∏–ª–∏ –º–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.';
    } else if (err.response.status >= 500) {
      errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
    }
  } else if (err.request) {
    errorMessage = '–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.';
  }
  
  setError(errorMessage);
  if (window.Telegram?.WebApp) {
    window.Telegram.WebApp.showAlert(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç:\n\n${errorMessage}`);
  }
}
```

**4. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**

```typescript
console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ submission:', {
  stepId: step.id,
  moduleId: step.module.id,
  answerType: step.expectedAnswer,
  hasText: !!answerText,
});
```

**5. Callback –¥–ª—è showAlert:**

```typescript
if (window.Telegram?.WebApp) {
  window.Telegram.WebApp.showAlert('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!', () => {
    navigate(-1); // –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –∞–ª–µ—Ä—Ç–∞
  });
} else {
  alert('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!');
  navigate(-1);
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–æ–¥—É–ª—å –Ω–µ –æ—Ç–∫—Ä—ã—Ç

```
1. –£—á–µ–Ω–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —à–∞–≥ –º–æ–¥—É–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–º
2. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
3. –£—á–µ–Ω–∏–∫ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–ª–µ—Ä—Ç: "‚ö†Ô∏è –ú–æ–¥—É–ª—å –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–º..."
5. ‚úÖ –û—Ç–≤–µ—Ç –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ backend
6. ‚úÖ –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã—Ç, –ø–µ—Ä–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

```
1. –ö—É—Ä–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥—É–ª—å –¥–ª—è —É—á–µ–Ω–∏–∫–∞
2. –£—á–µ–Ω–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —à–∞–≥
3. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É" –∞–∫—Ç–∏–≤–Ω–∞
4. –£—á–µ–Ω–∏–∫ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç
5. –ù–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
6. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "–û—Ç–ø—Ä–∞–≤–∫–∞..."
7. ‚úÖ Backend —Å–æ–∑–¥–∞—ë—Ç submission
8. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!"
9. ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —à–∞–≥–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

```
1. –£—á–µ–Ω–∏–∫ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç–≤–µ—Ç (status = SENT)
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ—Ç –∂–µ —à–∞–≥ —Å–Ω–æ–≤–∞
3. ‚úÖ –ü–æ–ª—è —Ñ–æ—Ä–º—ã disabled
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å: "SENT"
5. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
6. ‚úÖ –ï—Å–ª–∏ —É—á–µ–Ω–∏–∫ –æ–±–æ–π–¥—ë—Ç UI –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Üí –∞–ª–µ—Ä—Ç "–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –æ—Ç–≤–µ—Ç"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ö—É—Ä–∞—Ç–æ—Ä –≤–µ—Ä–Ω—É–ª –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

```
1. –ö—É—Ä–∞—Ç–æ—Ä –≤–µ—Ä–Ω—É–ª submission (status = CURATOR_RETURNED)
2. –£—á–µ–Ω–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —à–∞–≥
3. ‚úÖ –ü–æ–ª—è —Ñ–æ—Ä–º—ã –∞–∫—Ç–∏–≤–Ω—ã
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è feedback –∫—É—Ä–∞—Ç–æ—Ä–∞
5. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
6. ‚úÖ –£—á–µ–Ω–∏–∫ –º–æ–∂–µ—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```
1. –ü—É—Å—Ç–æ–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ:
   ‚úÖ "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: [—Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π]"
   
2. –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:
   ‚úÖ "–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ."
   
3. –û—à–∏–±–∫–∞ 403 –æ—Ç backend:
   ‚úÖ "–ú–æ–¥—É–ª—å –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–º. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥—É–ª—è."
   
4. –û—à–∏–±–∫–∞ 400 –æ—Ç backend:
   ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
```

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
ssh root@79.132.140.13
cd /var/www/tma_education

# 1. –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git pull

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å backend (–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ DTO –∏ service)
cd backend
npm run build
pm2 restart minto-backend

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å TMA
cd ../tma
npm run build

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
pm2 logs minto-backend --lines 20
```

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**Backend:**
- `backend/src/course/course.service.ts`:
  - `getStepWithProgress()` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç enrollment
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è answerText, aiFeedback, curatorFeedback –≤ submission

- `backend/src/course/dto/step-response.dto.ts`:
  - `StepWithProgressDto` –æ–±–Ω–æ–≤–ª—ë–Ω —Å module + enrollment
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è feedback –≤ submission

**Frontend:**
- `tma/src/pages/StepPage.tsx`:
  - –û–±–Ω–æ–≤–ª—ë–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Step` —Å enrollment
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥—É–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  - –î–æ–±–∞–≤–ª–µ–Ω console.log –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω callback –¥–ª—è Telegram.WebApp.showAlert

## Backend –∑–∞—â–∏—Ç–∞ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

Backend —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

```typescript
// 1. –ú–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω (enrollment.status === 'IN_PROGRESS')
if (!enrollment || enrollment.status !== 'IN_PROGRESS') {
  throw new ForbiddenException('Module is not available. Please wait for curator to unlock it.');
}

// 2. –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö submission
if (existingSubmission) {
  throw new BadRequestException('You have already submitted this step');
}

// 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞
if (step.expectedAnswer !== data.answerType) {
  throw new BadRequestException(
    `Expected answer type is ${step.expectedAnswer}, but got ${data.answerType}`,
  );
}

// 4. –ù–∞–ª–∏—á–∏–µ –æ—Ç–≤–µ—Ç–∞
if (data.answerType === 'TEXT' && !data.answerText?.trim()) {
  throw new BadRequestException('Answer text is required for TEXT type');
}
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞: "–ú–æ–¥—É–ª—å –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–º"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç enrollment –∏–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ IN_PROGRESS  
**–†–µ—à–µ–Ω–∏–µ:** –ö—É—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª—å —á–µ—Ä–µ–∑ "üîì –û—Ç–∫—Ä—ã—Ç—å –¥–ª—è –≤—Å–µ—Ö"

### –û—à–∏–±–∫–∞: "–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –æ—Ç–≤–µ—Ç"

**–ü—Ä–∏—á–∏–Ω–∞:** Submission —É–∂–µ —Å–æ–∑–¥–∞–Ω  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –µ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

### –û—à–∏–±–∫–∞: "Expected answer type is TEXT, but got undefined"

**–ü—Ä–∏—á–∏–Ω–∞:** Frontend –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç answerType  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ –∫–æ–¥–µ - `answerType: step.expectedAnswer || 'TEXT'`

### –û—à–∏–±–∫–∞: "Answer text is required for TEXT type"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç  
**–†–µ—à–µ–Ω–∏–µ:** Frontend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–æ –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏

### –û—à–∏–±–∫–∞: "–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –∏–ª–∏ backend –Ω–µ –∑–∞–ø—É—â–µ–Ω  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `pm2 status` –∏ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-11-29  
**–ü—Ä–æ–±–ª–µ–º–∞:** –£—á–µ–Ω–∏–∫–∏ –Ω–µ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–¥–∞–Ω–∏—è  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å enrollment + —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

