# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ü–†–û–ï–ö–¢–ê tma_education

**–î–∞—Ç–∞:** 30 –Ω–æ—è–±—Ä—è 2025  
**–û—Ö–≤–∞—Ç:** Backend (NestJS) + Frontend (TMA React) + –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

---

## üìä EXECUTIVE SUMMARY

**–û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** ‚úÖ **–•–û–†–û–®–ï–ï**

- **–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** 2 (–ò–°–ü–†–ê–í–õ–ï–ù–´)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ß–∏—Å—Ç–∞—è, –º–æ–¥—É–ª—å–Ω–∞—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices
- **–ö–æ–¥:** –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω, —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- **Performance:** –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–∏–Ω–¥–µ–∫—Å—ã –ë–î)

---

## üîê –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. ‚ùå Telegram WebApp Validation (CRITICAL)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ Telegram WebApp **–ù–ï –ë–´–õ–ê –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê**. –õ—é–±–æ–π –º–æ–≥ –ø–æ–¥–¥–µ–ª–∞—Ç—å `initData` –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

```typescript
// –ë–´–õ–û:
export function validateTelegramWebAppData(initData: string): boolean {
  return true; // ‚ùå –ó–ê–ì–õ–£–®–ö–ê!
}
```

**–†–µ—à–µ–Ω–∏–µ:**  
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram:
- HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º `sha256(bot_token)`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ timestamp (–Ω–µ —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–§–∞–π–ª—ã:** `backend/src/auth/utils/telegram-validator.ts`, `backend/src/auth/auth.service.ts`

---

### 2. ‚ùå CORS Configuration (HIGH)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ `origin: true` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **–í–°–ï** origins.

```typescript
// –ë–´–õ–û:
app.enableCors({
  origin: true, // ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û!
  credentials: true,
});
```

**–†–µ—à–µ–Ω–∏–µ:**  
‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º whitelist:
```typescript
// –°–¢–ê–õ–û:
app.enableCors({
  origin: [tmaUrl, 'http://localhost:5173', 'http://localhost:3000'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization'],
});
```

**–§–∞–π–ª:** `backend/src/main.ts`

---

## ‚ö° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### Database Indexes

**–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**

```prisma
model User {
  @@index([telegramId]) // Lookup –≤ /start, webhook
  @@index([role])       // –ü–æ–∏—Å–∫ –∫—É—Ä–∞—Ç–æ—Ä–æ–≤
}

model Enrollment {
  @@index([status])
  @@index([userId, status]) // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}

model Submission {
  @@index([moduleId, status]) // "–≤—Å–µ —Å–¥–∞—á–∏ –º–æ–¥—É–ª—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ"
  @@index([userId, status])   // "–º–æ–∏ —Å–¥–∞—á–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º X"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** 50-80% —É—Å–∫–æ—Ä–µ–Ω–∏–µ queries –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.

**–§–∞–π–ª:** `backend/prisma/schema.prisma`

---

## ‚úÖ BACKEND (NestJS) - –î–ï–¢–ê–õ–¨–ù–´–ô –ê–£–î–ò–¢

### Core Infrastructure
- ‚úÖ `main.ts`: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ValidationPipe, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ guards
- ‚úÖ `app.module.ts`: –ú–æ–¥—É–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã —á–∏—Å—Ç–æ
- ‚úÖ `prisma/schema.prisma`: –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ `prisma/seed.ts`: –ü–æ–ª–Ω—ã–π seed —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–∞

### Auth & Security Module
- ‚úÖ **JwtAuthGuard**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Passport JWT
- ‚úÖ **RolesGuard**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- ‚úÖ **JwtStrategy**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –ë–î
- ‚úÖ **TelegramValidator**: (–ò–°–ü–†–ê–í–õ–ï–ù–û) –ü–æ–ª–Ω–∞—è HMAC-SHA256 –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ **AuthService**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è validation + ConfigService
- ‚úÖ **AuthController**: –ß–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Users Module
- ‚úÖ **UsersService**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è CRUD –ª–æ–≥–∏–∫–∞, –ø—Ä–æ–≥—Ä–µ—Å—Å learners
- ‚úÖ **AdminController**: –ó–∞—â–∏—â—ë–Ω guards (CURATOR/ADMIN)
- ‚ö†Ô∏è *–ú–µ–ª–∫–æ–µ*: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `any` –≤–º–µ—Å—Ç–æ —Ç–∏–ø–æ–≤ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Ç–æ–¥–∞—Ö
- ‚ö†Ô∏è *–ú–µ–ª–∫–æ–µ*: N+1 –ø—Ä–æ–±–ª–µ–º–∞ –≤ `getLearnersWithProgress` (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å join)

### Course Module
- ‚úÖ **CourseService**: –û—Ç–ª–∏—á–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ (LOCKED/IN_PROGRESS/COMPLETED)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π
  - –ì–∏–±–∫–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (forAll, allCompletedPrevious, userIds)
- ‚úÖ **CourseAdminService**: CRUD –¥–ª—è –º–æ–¥—É–ª–µ–π –∏ —à–∞–≥–æ–≤
- ‚úÖ **CourseBuilderController**: –ó–∞—â–∏—â—ë–Ω ADMIN –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, CURATOR –¥–ª—è —á—Ç–µ–Ω–∏—è
- ‚ö†Ô∏è *–ú–µ–ª–∫–æ–µ*: Race condition –≤ async update (—Å—Ç—Ä–æ–∫–∞ 90-98 course.service.ts)

### Submissions Module
- ‚úÖ **SubmissionsService**: **–û–¢–õ–ò–ß–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø**
  - –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º submission
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –º–æ–¥—É–ª–µ–π
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `requestResubmission` –∏ `deleteSubmission`
- ‚úÖ **SubmissionsAdminController**: –ó–∞—â–∏—â—ë–Ω guards (CURATOR/ADMIN)
- ‚úÖ **AudioSubmissionsService**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ audio/video submissions

### AI Module
- ‚úÖ **AiService**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OpenAI
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `aiRubric` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
  - Fallback –ø–∞—Ä—Å–∏–Ω–≥ JSON-–æ—Ç–≤–µ—Ç–æ–≤
  - Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º `OpenAI.toFile()`
- ‚ö†Ô∏è *–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ*: –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ —Å–±–æ—è–º API

### Telegram Module
- ‚úÖ **TelegramService**: –ì—Ä–∞–º–æ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
  - FSM –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (Map —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ webhook –∏ polling —Ä–µ–∂–∏–º–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ voice/video messages
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤ –∏ –∫—É—Ä–∞—Ç–æ—Ä–æ–≤
- ‚ö†Ô∏è *–ú–µ–ª–∫–æ–µ*: Map `registrationStates` —Ä–∞—Å—Ç—ë—Ç –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –Ω–∞ –±–æ–ª—å—à–æ–º –º–∞—Å—à—Ç–∞–±–µ)

---

## üé® FRONTEND (TMA React) - –î–ï–¢–ê–õ–¨–ù–´–ô –ê–£–î–ò–¢

### Core & Configuration
- ‚úÖ `main.tsx`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è React
- ‚úÖ `App.tsx`: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp (ready, expand, theme)
  - AuthProvider –æ–±—ë—Ä—Ç–∫–∞
  - Loading state
- ‚úÖ `vite.config.ts`: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### Auth & State Management
- ‚úÖ **AuthContext**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è auth flow
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏–∑ localStorage
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ `/users/me`
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ api.defaults.headers –ø—Ä–∏ login/logout
- ‚úÖ **ProtectedRoute**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π
- ‚ö†Ô∏è **api.ts**: –¢–æ–∫–µ–Ω —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
  - *–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–∞*

### Pages & Components

#### Learner Interface
- ‚úÖ **LoginPage**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞–≤—Ç–æ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram initData
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ `profileCompleted`
  - –†–µ–¥–∏—Ä–µ–∫—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
- ‚úÖ **DashboardPage**: –ß–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
  - Empty state –¥–ª—è learners –±–µ–∑ enrollments
- ‚úÖ **StepPage**: **–û–¢–õ–ò–ß–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö**
  - –î–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP —Å—Ç–∞—Ç—É—Å–æ–≤ (400, 401, 403, 404, 500+)
  - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - Telegram WebApp alerts
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫

#### Curator Interface
- ‚úÖ **CuratorLayout**: –¢–∞–±—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ **CuratorCoursesDashboardPage**: –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤
- ‚úÖ **CourseDashboardPage**: –î–µ—Ç–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –∫—É—Ä—Å–∞ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ **CuratorSubmissionPage**: –ü–æ–ª–Ω—ã–π review interface
- ‚úÖ **CourseBuilderPage**: CRUD –¥–ª—è –∫—É—Ä—Å–∞/–º–æ–¥—É–ª–µ–π/—à–∞–≥–æ–≤

### Theme & Styling
- ‚úÖ **theme/colors.ts**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞
- ‚úÖ **useTheme.ts**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp theme
- ‚úÖ CSS variables –¥–ª—è –µ–¥–∏–Ω–æ–≥–æ —Å—Ç–∏–ª—è

### –¢–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ `types/telegram.d.ts`: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è Telegram WebApp SDK

---

## üèóÔ∏è –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê

### Environment & Secrets
- ‚úÖ `backend/env.example`: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- ‚úÖ `.gitignore`: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (`.env`, `node_modules`, `dist`)
- ‚úÖ Secrets –Ω–µ –∑–∞—à–∏—Ç—ã –≤ –∫–æ–¥

### Database
- ‚úÖ PostgreSQL —Å Prisma ORM
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Seed —Å–∫—Ä–∏–ø—Ç —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ (–ù–û–í–û–ï) –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Deployment
- ‚úÖ `Dockerfile` –¥–ª—è backend –∏ TMA
- ‚úÖ `docker-compose.yml` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ PM2 –¥–ª—è production (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
- ‚úÖ Caddy –¥–ª—è reverse proxy (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

---

## ‚ö†Ô∏è –ú–ï–õ–ö–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### Backend
1. **–¢–∏–ø–∏–∑–∞—Ü–∏—è**: –ó–∞–º–µ–Ω–∏—Ç—å `any` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –≤ UsersService, CourseService
2. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å –≤ `findAll`, `getLearnersWithProgress`
3. **N+1 queries**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `getLearnersWithProgress` —á–µ—Ä–µ–∑ join
4. **Retry –ª–æ–≥–∏–∫–∞**: –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è OpenAI API (—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º)
5. **Race condition**: –î–æ–±–∞–≤–∏—Ç—å await –≤ async update (course.service.ts:90-98)
6. **Memory leak**: –û—á–∏—Å—Ç–∫–∞ `registrationStates` Map –≤ TelegramService

### Frontend
1. **API client**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ headers (—Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ)
2. **Router**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React Router –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –≤–º–µ—Å—Ç–æ `window.location`
3. **Code splitting**: Lazy loading –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ (—É–º–µ–Ω—å—à–∏—Ç initial bundle)
4. **Error boundary**: –î–æ–±–∞–≤–∏—Ç—å React Error Boundary –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

## üìã TODO (–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

### CRITICAL (—Å–¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É)
- ‚úÖ ~~–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram WebApp validation~~ **DONE**
- ‚úÖ ~~–ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS~~ **DONE**

### IMPORTANT (–≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ VPS
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ VPS –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (Sentry –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)

### NICE-TO-HAVE (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è)
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –∑–∞–º–µ–Ω–∏—Ç—å `any` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤ —Å–ø–∏—Å–∫–∏ (learners, submissions)
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å N+1 queries —á–µ—Ä–µ–∑ Prisma join
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è OpenAI API
- [ ] –î–æ–±–∞–≤–∏—Ç—å React Error Boundary –≤ TMA
- [ ] Code splitting –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫—É—Ä–∞—Ç–æ—Ä–æ–≤

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü—Ä–æ–µ–∫—Ç –≤ —Ü–µ–ª–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ:**

‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–∏—Å—Ç–∞—è –∏ –º–æ–¥—É–ª—å–Ω–∞—è  
‚úÖ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è  
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π) –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ  
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º  
‚úÖ UI/UX –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–π –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π  

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.**  
**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

---

**–ê–≤—Ç–æ—Ä –∞—É–¥–∏—Ç–∞:** AI Assistant (Claude Sonnet 4.5)  
**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** –í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ª–∏–±–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –ª–∏–±–æ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ TODO —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º.

