# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –æ–±—É—á–µ–Ω–∏—è ¬´–ü–∏—Ä–∞–º–∏–¥–∞ –ú–∏–Ω—Ç–æ¬ª

## üéØ –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–µ–∫–µ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ backend –∏ frontend:

- **Backend:** NestJS + Prisma + PostgreSQL + OpenAI
- **Frontend:** React (Telegram Mini App)
- **Telegram Bot:** Thin layer –¥–ª—è –≤—Ö–æ–¥–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **Backend –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** ‚Äî –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL
2. **Telegram Mini App –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π UI** ‚Äî –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è –∏ –∫—É—Ä–∞—Ç–æ—Ä–æ–≤
3. **Telegram Bot –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** ‚Äî –∫–æ–º–∞–Ω–¥–∞ `/start`, –∫–Ω–æ–ø–∫–∞ WebApp, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ —Ä–æ–ª–∏ (LEARNER, CURATOR, ADMIN)
5. **–°–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ –ë–î** ‚Äî FSM —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å—ã –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö Enrollment –∏ Submission

---

## üèóÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### Backend (NestJS)

**–ú–æ–¥—É–ª–∏:**

- **`DatabaseModule`** ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç PrismaService
- **`AuthModule`** ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp, JWT
- **`UsersModule`** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **`CourseModule`** ‚Äî –º–æ–¥—É–ª–∏ –∏ —à–∞–≥–∏ –∫—É—Ä—Å–∞
- **`SubmissionsModule`** ‚Äî —Å–¥–∞—á–∏ –∑–∞–¥–∞–Ω–∏–π
- **`TelegramModule`** ‚Äî Telegram Bot (–∫–æ–º–∞–Ω–¥—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- **`AiModule`** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**

- `AuthService` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è Telegram WebApp initData, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT
- `UsersService` ‚Äî CRUD –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±—É—á–∞—é—â–∏—Ö—Å—è
- `CourseService` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π/—à–∞–≥–æ–≤, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–æ–¥—É–ª—è, –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª–µ–π
- `SubmissionsService` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–∞—á, –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ò–ò, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- `TelegramService` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `AiService` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π —á–µ—Ä–µ–∑ OpenAI

### Frontend (Telegram Mini App)

**React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Vite:**

- **–†–æ—É—Ç–∏–Ω–≥:** React Router —Å –∑–∞—â–∏—â—ë–Ω–Ω—ã–º–∏ —Ä–æ—É—Ç–∞–º–∏
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** AuthContext —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- **API –∫–ª–∏–µ–Ω—Ç:** Axios —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤

**–≠–∫—Ä–∞–Ω—ã –¥–ª—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è:**

- `DashboardPage` ‚Äî —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º, –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ"
- `ModulePage` ‚Äî —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ –º–æ–¥—É–ª—è —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- `StepPage` ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç —à–∞–≥–∞, —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–¥–∞—á–∏
- `SubmissionsPage` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–≠–∫—Ä–∞–Ω—ã –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤:**

- `CuratorDashboardPage` ‚Äî —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- `CuratorUserPage` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞, –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª–µ–π

### Telegram Bot

**–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å–ª–æ–π:**

- –ö–æ–º–∞–Ω–¥–∞ `/start` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ WebApp
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
  - –ö—É—Ä–∞—Ç–æ—Ä–∞–º –æ –Ω–æ–≤—ã—Ö —Å–¥–∞—á–∞—Ö
  - –û–±—É—á–∞—é—â–∏–º—Å—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏
  - –û –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–æ–¥—É–ª–µ–π
  - –û–± –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

---

## üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏

#### User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

```prisma
model User {
  id           String   @id @default(cuid())
  telegramId   String   @unique
  firstName    String?
  lastName     String?
  position     String?
  role         UserRole @default(LEARNER)  // LEARNER, CURATOR, ADMIN
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  enrollments  Enrollment[]
  submissions Submission[]
  unlockedEnrollments Enrollment[] @relation("UnlockedBy")
}
```

**–†–æ–ª–∏:**
- `LEARNER` ‚Äî –æ–±—É—á–∞—é—â–∏–π—Å—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `CURATOR` ‚Äî –∫—É—Ä–∞—Ç–æ—Ä (–º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–æ–¥—É–ª–∏, –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–¥–∞—á–∏)
- `ADMIN` ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–º)

#### CourseModule (–ú–æ–¥—É–ª—å –∫—É—Ä—Å–∞)

```prisma
model CourseModule {
  id          String        @id @default(cuid())
  index       Int           @unique  // 1, 2, 3, 4 (4 = —ç–∫–∑–∞–º–µ–Ω)
  title       String
  description String?
  isExam      Boolean       @default(false)

  steps       CourseStep[]
  enrollments Enrollment[]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–¥—É–ª–∏ –∏–º–µ—é—Ç –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä (`index`)
- –ú–æ–¥—É–ª—å 4 –æ–±—ã—á–Ω–æ —è–≤–ª—è–µ—Ç—Å—è —ç–∫–∑–∞–º–µ–Ω–æ–º (`isExam = true`)
- –ú–æ–¥—É–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫—É—Ä–∞—Ç–æ—Ä–æ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

#### CourseStep (–®–∞–≥/–∑–∞–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è)

```prisma
model CourseStep {
  id               String          @id @default(cuid())
  moduleId         String
  index            Int             // –ø–æ—Ä—è–¥–æ–∫ –≤ –º–æ–¥—É–ª–µ
  type             StepType        // INFO, TASK, QUIZ, EXAM
  title            String
  content          String          // —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è
  requiresAiReview Boolean         @default(false)
  expectedAnswer   AnswerType      @default(TEXT)
  maxScore         Int             @default(10)
  isRequired       Boolean         @default(true)  // –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ª–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥—É–ª—è
  formSchema       Json?           // JSON-—Å—Ö–µ–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã –æ—Ç–≤–µ—Ç–∞
  aiRubric         String?         // –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –ò–ò-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–≥–∞
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  submissions      Submission[]
}
```

**–¢–∏–ø—ã —à–∞–≥–æ–≤:**
- `INFO` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π (–±–µ–∑ —Å–¥–∞—á–∏)
- `TASK` ‚Äî –∑–∞–¥–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç–∞)
- `QUIZ` ‚Äî –∫–≤–∏–∑
- `EXAM` ‚Äî —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ

**–¢–∏–ø—ã –æ—Ç–≤–µ—Ç–æ–≤:**
- `TEXT` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
- `AUDIO` ‚Äî –∞—É–¥–∏–æ—Å–æ–æ–±—â–µ–Ω–∏–µ
- `VIDEO` ‚Äî –≤–∏–¥–µ–æ—Å–æ–æ–±—â–µ–Ω–∏–µ
- `FILE` ‚Äî —Ñ–∞–π–ª

#### Enrollment (–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–æ–¥—É–ª—é)

```prisma
model Enrollment {
  id        String         @id @default(cuid())
  userId    String
  moduleId  String
  status    ModuleStatus   @default(LOCKED)  // LOCKED, IN_PROGRESS, COMPLETED
  unlockedById String?     // ID –∫—É—Ä–∞—Ç–æ—Ä–∞, –æ—Ç–∫—Ä—ã–≤—à–µ–≥–æ –º–æ–¥—É–ª—å
  unlockedAt DateTime?
  completedAt DateTime?
}
```

**–°—Ç–∞—Ç—É—Å—ã –º–æ–¥—É–ª—è:**
- `LOCKED` ‚Äî –º–æ–¥—É–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `IN_PROGRESS` ‚Äî –º–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã—Ç, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
- `COMPLETED` ‚Äî –º–æ–¥—É–ª—å –∑–∞–≤–µ—Ä—à—ë–Ω (–≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –æ–¥–æ–±—Ä–µ–Ω—ã)

**–õ–æ–≥–∏–∫–∞:**
- –ú–æ–¥—É–ª—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º, –∫–æ–≥–¥–∞ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ (TASK, QUIZ, EXAM) –∏–º–µ—é—Ç Submission —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `CURATOR_APPROVED`
- –°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä–æ–º

#### Submission (–°–¥–∞—á–∞ –∑–∞–¥–∞–Ω–∏—è)

```prisma
model Submission {
  id             String          @id @default(cuid())
  userId         String
  moduleId       String
  stepId         String
  answerText     String?
  answerFileId   String?
  answerType     AnswerType      @default(TEXT)
  aiScore        Float?
  aiFeedback     String?
  curatorScore   Float?
  curatorFeedback String?
  status         SubmissionStatus @default(SENT)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
}
```

**–°—Ç–∞—Ç—É—Å—ã —Å–¥–∞—á–∏:**
- `SENT` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
- `AI_REVIEWED` ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ò–ò (–µ—Å–ª–∏ `requiresAiReview = true`)
- `CURATOR_APPROVED` ‚Äî –æ–¥–æ–±—Ä–µ–Ω–æ –∫—É—Ä–∞—Ç–æ—Ä–æ–º
- `CURATOR_RETURNED` ‚Äî –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí `status = SENT`
2. –ï—Å–ª–∏ `requiresAiReview = true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ò–ò ‚Üí `status = AI_REVIEWED`
3. –ö—É—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ‚Üí `status = CURATOR_APPROVED` –∏–ª–∏ `CURATOR_RETURNED`

---

## üë• –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### LEARNER (–û–±—É—á–∞—é—â–∏–π—Å—è)

**–î–æ—Å—Ç—É–ø:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –º–æ–¥—É–ª–µ–π –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –º–æ–¥—É–ª–µ–π
- –°–¥–∞—á–∞ –∑–∞–¥–∞–Ω–∏–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö —Å–¥–∞—á –∏ –æ—Ü–µ–Ω–æ–∫

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
- –ù–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ù–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å

### CURATOR (–ö—É—Ä–∞—Ç–æ—Ä)

**–î–æ—Å—Ç—É–ø:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª–µ–π –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–¥–∞—á
- –û–¥–æ–±—Ä–µ–Ω–∏–µ/–≤–æ–∑–≤—Ä–∞—Ç —Å–¥–∞—á
- –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–∞ (–º–æ–¥—É–ª–∏/—à–∞–≥–∏)
- –ù–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ADMIN (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

**–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø:**
- –í—Å–µ –ø—Ä–∞–≤–∞ –∫—É—Ä–∞—Ç–æ—Ä–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫—É—Ä—Å–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π –∏ —à–∞–≥–æ–≤)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π)
- –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏

### –ü–æ—Ç–æ–∫ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ ‚Üí –∫–æ–º–∞–Ω–¥–∞ /start
2. Telegram Bot:
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç telegramId –∏–∑ ctx.from.id
   - –ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ telegramId
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí —Å–æ–∑–¥–∞—ë—Ç —Å role = LEARNER
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å —É—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" (WebApp)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è TMA
4. TMA –ø–æ–ª—É—á–∞–µ—Ç initData –æ—Ç Telegram WebApp
5. TMA –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /auth/telegram-webapp —Å initData
6. Backend:
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å initData
   - –ù–∞—Ö–æ–¥–∏—Ç/—Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { access_token, user }
7. TMA —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç:
   - LEARNER ‚Üí /dashboard
   - CURATOR/ADMIN ‚Üí /curator
```

### –ü–æ—Ç–æ–∫ 2: –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ–¥—É–ª—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ Dashboard –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π
2. Backend GET /course/modules –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥—É–ª–∏ —Å Enrollment.status
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ"
4. Backend GET /course/current –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π IN_PROGRESS –º–æ–¥—É–ª—å
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥—É–ª—å ‚Üí GET /course/modules/:id/steps
6. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —à–∞–≥–∏ —Å Submission.status –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —à–∞–≥ ‚Üí GET /course/steps/:id
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –æ—Ç–≤–µ—Ç–∞:
   - –ï—Å–ª–∏ —É —à–∞–≥–∞ –µ—Å—Ç—å `formSchema` ‚Üí TMA —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏
   - –ï—Å–ª–∏ `formSchema` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –ø—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
9. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" ‚Üí POST /submissions:
   - –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º: `answerText` —Å–æ–¥–µ—Ä–∂–∏—Ç JSON `{ "field_id": "–∑–Ω–∞—á–µ–Ω–∏–µ" }`
   - –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º: `answerText` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
10. Backend:
    - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç: –º–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω, —à–∞–≥ –Ω–µ —Å–¥–∞–Ω —Ä–∞–Ω–µ–µ
    - –°–æ–∑–¥–∞—ë—Ç Submission —Å–æ status = SENT
    - –ï—Å–ª–∏ requiresAiReview = true ‚Üí –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç OpenAI
    - –û–±–Ω–æ–≤–ª—è–µ—Ç Submission: aiScore, aiFeedback, status = AI_REVIEWED
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫—É—Ä–∞—Ç–æ—Ä–∞–º —á–µ—Ä–µ–∑ Telegram Bot
11. –ö—É—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–û–¥–æ–±—Ä–∏—Ç—å" / "–í–µ—Ä–Ω—É—Ç—å"
12. –ö—É—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ‚Üí POST /admin/submissions/:id/approve –∏–ª–∏ /return
13. Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç Submission –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–æ–¥—É–ª—è
14. –ï—Å–ª–∏ –≤—Å–µ —à–∞–≥–∏ –æ–¥–æ–±—Ä–µ–Ω—ã ‚Üí Enrollment.status = COMPLETED
15. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
```

### –ü–æ—Ç–æ–∫ 3: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–º

```
1. –ö—É—Ä–∞—Ç–æ—Ä –≤ TMA –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—á–∞—Å—Ç–Ω–∏–∫–∞
2. Backend GET /admin/learners/:id –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
3. –ö—É—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ (status = LOCKED)
4. –ö—É—Ä–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª—å N"
5. TMA –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /admin/modules/:moduleId/unlock —Å userIds
6. Backend:
    - –°–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç Enrollment: status = IN_PROGRESS, unlockedById, unlockedAt
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫—É —á–µ—Ä–µ–∑ Telegram Bot
7. –£—á–∞—Å—Ç–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥—É–ª—è
```

### –ü–æ—Ç–æ–∫ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ –ò–ò

```
1. Submission —Å–æ–∑–¥–∞–Ω–∞ —Å–æ status = SENT, requiresAiReview = true
2. SubmissionsService.reviewWithAI() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
3. AiService.reviewSubmission() —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç:
   - –¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è (step.content)
   - –û—Ç–≤–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ (submission.answerText)
   - –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ (–∏–∑ –º–µ—Ç–æ–¥–∏–∫–∏ –∏–ª–∏ step.aiRubric)
4. OpenAI API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON: { score, feedback }
5. Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç Submission:
   - aiScore = score
   - aiFeedback = feedback
   - status = AI_REVIEWED
6. TelegramService.notifyCuratorAboutSubmission() –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫—É—Ä–∞—Ç–æ—Ä–∞–º
```

---

## ü§ñ Telegram Bot (Thin Layer)

Telegram Bot —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **grammY** –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### –ö–æ–º–∞–Ω–¥–∞ /start

```typescript
bot.command('start', async (ctx) => {
  const telegramId = ctx.from.id.toString();
  let user = await usersService.findByTelegramId(telegramId);
  if (!user) {
    user = await usersService.create({ telegramId, role: 'LEARNER' });
  }
  await ctx.reply('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', {
    reply_markup: {
      inline_keyboard: [[{
        text: 'üìö –û—Ç–∫—Ä—ã—Ç—å —É—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
        web_app: { url: TMA_URL }
      }]]
    }
  });
});
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ö—É—Ä–∞—Ç–æ—Ä–∞–º:**
- –û –Ω–æ–≤—ã—Ö —Å–¥–∞—á–∞—Ö (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ò–ò)
- –° inline-–∫–Ω–æ–ø–∫–∞–º–∏ "–û–¥–æ–±—Ä–∏—Ç—å" / "–í–µ—Ä–Ω—É—Ç—å"

**–û–±—É—á–∞—é—â–∏–º—Å—è:**
- –û —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ–¥–æ–±—Ä–µ–Ω–æ/–≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ)
- –û –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–æ–¥—É–ª—è
- –û–± –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ë–æ—Ç –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ –ë–î
- –ë–æ—Ç –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ ‚Äî –≤—Å—ë —á–µ—Ä–µ–∑ TMA
- –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## üì± Telegram Mini App (Frontend)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- React 18 + TypeScript
- Vite –¥–ª—è —Å–±–æ—Ä–∫–∏
- React Router –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- Axios –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- Telegram WebApp SDK –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
tma/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/      # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ contexts/        # React Context (AuthContext)
‚îÇ   ‚îú‚îÄ‚îÄ pages/           # –≠–∫—Ä–∞–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ services/        # API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ types/           # TypeScript —Ç–∏–ø—ã
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
   ```typescript
   const tg = window.Telegram.WebApp;
   tg.ready();
   tg.expand();
   const initData = tg.initData;
   ```

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
   ```typescript
   const response = await api.post('/auth/telegram-webapp', { initData });
   const { access_token, user } = response.data;
   localStorage.setItem('token', access_token);
   ```

3. **–ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤:**
   ```typescript
   <ProtectedRoute allowedRoles={['LEARNER']}>
     <DashboardPage />
   </ProtectedRoute>
   ```

### –≠–∫—Ä–∞–Ω—ã

**–î–ª—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è:**
- `/dashboard` ‚Äî —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π, –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
- `/modules/:moduleId` ‚Äî —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ –º–æ–¥—É–ª—è
- `/steps/:stepId` ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç —à–∞–≥–∞, —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞
- `/submissions` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–¥–∞—á

**–î–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤:**
- `/curator` ‚Äî —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `/curator/users/:userId` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞

---

## üõ†Ô∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫—É—Ä—Å–∞

### –û–±–∑–æ—Ä

–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫—É—Ä—Å–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫—É—Ä–∞—Ç–æ—Ä–∞–º –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–∞ —á–µ—Ä–µ–∑ Telegram Mini App.

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### CourseModule (–ú–æ–¥—É–ª—å)

**–ü–æ–ª—è:**
- `index` ‚Äî –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä (1, 2, 3, 4)
- `title` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è
- `description` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è
- `isExam` ‚Äî —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–æ–¥—É–ª—å —ç–∫–∑–∞–º–µ–Ω–æ–º

**API:**
- `GET /admin/course/modules` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- `POST /admin/course/modules` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è
- `PUT /admin/course/modules/:id` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è
- `DELETE /admin/course/modules/:id` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è

#### CourseStep (–®–∞–≥)

**–ü–æ–ª—è:**
- `moduleId` ‚Äî ID –º–æ–¥—É–ª—è
- `index` ‚Äî –ø–æ—Ä—è–¥–æ–∫ –≤ –º–æ–¥—É–ª–µ
- `type` ‚Äî —Ç–∏–ø —à–∞–≥–∞ (INFO, TASK, QUIZ, EXAM)
- `title` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞
- `content` ‚Äî —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è/—Ç–µ–æ—Ä–∏–∏
- `requiresAiReview` ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ò–ò
- `expectedAnswer` ‚Äî —Ç–∏–ø –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (TEXT, AUDIO, VIDEO, FILE)
- `maxScore` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª
- `isRequired` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ª–∏ —à–∞–≥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥—É–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `formSchema` ‚Äî JSON —Å—Ö–µ–º–∞ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã –æ—Ç–≤–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `aiRubric` ‚Äî —Ç–µ–∫—Å—Ç –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –¥–ª—è –ò–ò-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—ã (formSchema):**

–ï—Å–ª–∏ `formSchema` –∑–∞–¥–∞–Ω, TMA —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Ñ–æ—Ä–º—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è.

**–§–æ—Ä–º–∞—Ç formSchema:**
```json
{
  "fields": [
    { 
      "id": "field_1", 
      "label": "–ì–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å", 
      "type": "text", 
      "required": true 
    },
    { 
      "id": "field_2", 
      "label": "–ê—Ä–≥—É–º–µ–Ω—Ç—ã", 
      "type": "textarea", 
      "required": true 
    }
  ]
}
```

**–¢–∏–ø—ã –ø–æ–ª–µ–π:**
- `text` ‚Äî –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
- `textarea` ‚Äî –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
- `file` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (–±–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –í TMA: `StepPage` –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –ø–æ–ª—è –ø–æ —Å—Ö–µ–º–µ
- –û—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `Submission.answerText` –∫–∞–∫ JSON: `{ "field_1": "–∑–Ω–∞—á–µ–Ω–∏–µ", "field_2": "–∑–Ω–∞—á–µ–Ω–∏–µ" }`
- –ï—Å–ª–∏ `formSchema` –Ω–µ –∑–∞–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ò–ò (aiRubric):**

–ï—Å–ª–∏ `aiRubric` –∑–∞–¥–∞–Ω, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –æ–±—â–∏—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ú–∏–Ω—Ç–æ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–µ—Ä–µ–∑ OpenAI.

**–§–æ—Ä–º–∞—Ç:** –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∫–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ `SubmissionsService` –ø–µ—Ä–µ–¥–∞—ë—Ç `aiRubric` –≤ `AiService.reviewSubmission()`
- –ï—Å–ª–∏ `aiRubric` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–∏—Ä–∞–º–∏–¥—ã –ú–∏–Ω—Ç–æ

**API:**
- `GET /admin/course/modules/:moduleId/steps` ‚Äî —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ –º–æ–¥—É–ª—è
- `POST /admin/course/steps` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —à–∞–≥–∞
- `PUT /admin/course/steps/:id` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–∞
- `DELETE /admin/course/steps/:id` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —à–∞–≥–∞
- `POST /admin/course/steps/:id/reorder` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —à–∞–≥–æ–≤

### –≠–∫—Ä–∞–Ω—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ú–æ–¥—É–ª–∏:**
- ‚úÖ –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π (`CourseBuilderPage`) —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–∞, –Ω–∞–∑–≤–∞–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤
- ‚úÖ –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è (`CourseModuleEditorPage`):
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `title`, `description`, `index`, `isExam`
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `POST /admin/course/modules` –∏–ª–∏ `PATCH /admin/course/modules/:id`
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ø–∏—Å–∫—É —à–∞–≥–æ–≤ –º–æ–¥—É–ª—è

**–®–∞–≥–∏:**
- ‚úÖ –°–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ –º–æ–¥—É–ª—è (`CourseStepsPage`) —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–∞, –Ω–∞–∑–≤–∞–Ω–∏—è, —Ç–∏–ø–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–≥–∞ (`CourseStepEditorPage`):
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π: `title`, `type`, `index`, `content`, `expectedAnswer`, `requiresAiReview`, `maxScore`, `isRequired`
  - **–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º** (`FormSchemaBuilder`):
    - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∏–ø–∞ –ø–æ–ª—è (text, textarea, file)
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π
    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `formSchema` –∫–∞–∫ JSON
  - **–†–µ–¥–∞–∫—Ç–æ—Ä –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ò–ò**:
    - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è `aiRubric`
    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `POST /admin/course/steps` –∏–ª–∏ `PATCH /admin/course/steps/:id`

#### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

**–£–ª—É—á—à–µ–Ω–∏—è UI:**
- ‚è≥ Drag & drop –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –º–æ–¥—É–ª–µ–π
- ‚è≥ Drag & drop –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ —à–∞–≥–æ–≤
- ‚è≥ Markdown-—Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –ø–æ–ª—è `content` (—Å–µ–π—á–∞—Å –æ–±—ã—á–Ω—ã–π textarea)
- ‚è≥ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä `aiRubric` (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Å –≤–µ—Å–∞–º–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)
- ‚è≥ –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:**
- `index` –º–æ–¥—É–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- `index` —à–∞–≥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≤ —Ä–∞–º–∫–∞—Ö –º–æ–¥—É–ª—è
- `maxScore` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0
- `formSchema` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º JSON (–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ backend)
- `aiRubric` ‚Äî —Å—Ç—Ä–æ–∫–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

**–ó–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π:**
- –ï—Å–ª–∏ —É —à–∞–≥–∞ –µ—Å—Ç—å Submission, –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å: `type`, `expectedAnswer`, `isRequired`, `maxScore`
- –†–∞–∑—Ä–µ—à–µ–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å: `title`, `content`, `formSchema`, `aiRubric`

**–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:**
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å, –µ—Å–ª–∏ –µ—Å—Ç—å Enrollment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º IN_PROGRESS –∏–ª–∏ COMPLETED
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —à–∞–≥, –µ—Å–ª–∏ –µ—Å—Ç—å Submission –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥–∞

---

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### OpenAI API

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π —Å `requiresAiReview = true`
- –ú–æ–¥–µ–ª—å: `gpt-5.1-2025-11-13` –∏–ª–∏ `gpt-3.5-turbo` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

**–ü—Ä–æ–º–ø—Ç:**
```
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–∏—Ä–∞–º–∏–¥–µ –ú–∏–Ω—Ç–æ. –û—Ü–µ–Ω–∏ –æ—Ç–≤–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:
1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≥–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å –≤ –Ω–∞—á–∞–ª–µ)
2. –ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è
3. –Ø—Å–Ω–æ—Å—Ç—å –∏–∑–ª–æ–∂–µ–Ω–∏—è

–ó–∞–¥–∞–Ω–∏–µ: {step.content}
–û—Ç–≤–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞: {submission.answerText}

–í–µ—Ä–Ω–∏ JSON:
{
  "score": 0-10,
  "feedback": "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
- –û—Ç–≤–µ—Ç –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫ JSON
- –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –æ—Ü–µ–Ω–∫–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫

### Telegram WebApp

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
- SDK –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `<script>` –≤ `index.html`
- `window.Telegram.WebApp` –¥–æ—Å—Ç—É–ø–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ `initData` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `showAlert()` –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `expand()` –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- `themeParams` –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ —Ç–µ–º—É Telegram

---

## üé§ –†–∞–±–æ—Ç–∞ —Å –º–µ–¥–∏–∞-–æ—Ç–≤–µ—Ç–∞–º–∏

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î:
  - `AnswerType` enum: `TEXT`, `AUDIO`, `VIDEO`, `FILE`
  - –ü–æ–ª–µ `answerFileId` –≤ `Submission` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `file_id` –∏–∑ Telegram
  - –ü–æ–ª–µ `answerType` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è:
  - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Submission –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ `answerFileId` –¥–ª—è –Ω–µ-TEXT —Ç–∏–ø–æ–≤
  - API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É `answerFileId` –∏ `answerType`

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå UI –≤ TMA –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏/–æ—Ç–ø—Ä–∞–≤–∫–∏ –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ/—Ñ–∞–π–ª–æ–≤
- ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞-—Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram Bot (`voice`, `video_note`, `document`)
- ‚ùå –ü–æ–ª—É—á–µ–Ω–∏–µ `file_id` –∏–∑ Telegram –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Submission
- ‚ùå –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–¥–∏–∞ –≤ TMA (–ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ, –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ)
- ‚ùå –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ –≤ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ AI

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –ø–∞–π–ø–ª–∞–π–Ω

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Telegram Bot**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `voice`/`video_note`/`document` –≤ –±–æ—Ç
2. Bot –ø–æ–ª—É—á–∞–µ—Ç `file_id` –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
3. Bot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ TMA –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `file_id` –≤ –ë–î
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ TMA –≤—ã–±–∏—Ä–∞–µ—Ç —à–∞–≥ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É
5. Backend —Å–æ–∑–¥–∞—ë—Ç Submission —Å `answerFileId = file_id`

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ TMA**
1. TMA –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram WebApp API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
2. –ü–æ–ª—É—á–µ–Ω–Ω—ã–π `file_id` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ backend –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Submission
3. Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `file_id` –≤ `Submission.answerFileId`

**–î–ª—è AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–¥–∏–∞:**
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ OpenAI Whisper API
- –ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ `AiService.reviewSubmission()`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –≤ `Submission.answerText` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è

1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `CourseModule` —á–µ—Ä–µ–∑ API –∏–ª–∏ Prisma Studio
2. –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥–∏ —á–µ—Ä–µ–∑ `CourseStep`
3. –ö—É—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ —à–∞–≥–∞

1. –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ enum `StepType` –≤ `schema.prisma`
2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `npx prisma migrate dev`
3. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `CourseService` –∏ `SubmissionsService`
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ TMA (StepPage)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –æ—Ç–≤–µ—Ç–∞

1. –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ enum `AnswerType` –≤ `schema.prisma`
2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
3. –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `SubmissionsService.create()`
4. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ TMA

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

**Webhooks:**
- –°–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ webhook –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- –ü—Ä–∏–º–µ—Ä: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Slack –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–æ–¥—É–ª—è

**–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:**
- API –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –§–æ—Ä–º–∞—Ç—ã: JSON, CSV, Excel

---

## üìù –ó–∞–º–µ—Ç–∫–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°–æ—Å—Ç–æ—è–Ω–∏—è (FSM)

FSM —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å—ã –≤ –ë–î, –∞ –Ω–µ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `state`:

- **–ú–æ–¥—É–ª—å:** `Enrollment.status` (LOCKED ‚Üí IN_PROGRESS ‚Üí COMPLETED)
- **–°–¥–∞—á–∞:** `Submission.status` (SENT ‚Üí AI_REVIEWED ‚Üí CURATOR_APPROVED/RETURNED)
- **–¢–µ–∫—É—â–∏–π –º–æ–¥—É–ª—å:** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–≤—ã–π `IN_PROGRESS` –∏–ª–∏ –ø–µ—Ä–≤—ã–π `LOCKED`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –æ–±—ë—Ä–Ω—É—Ç—ã –≤ try-catch
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ NestJS Logger
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (userId, moduleId, stepId, status)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Redis –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ò–ò-–ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ Submission)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º (30 –¥–Ω–µ–π)
- –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram WebApp initData (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ Guards –≤ NestJS
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ class-validator

---

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
  - `GET /admin/learners` ‚Äî —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
  - `GET /admin/learners/:id` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –ë–î —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
  - –ë–∞–ª–ª—ã (`aiScore`, `curatorScore`)
  - –°—Ç–∞—Ç—É—Å—ã –º–æ–¥—É–ª–µ–π –∏ —Å–¥–∞—á
  - –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå –°–≤–æ–¥–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  - –°—Ä–µ–¥–Ω–∏–µ –±–∞–ª–ª—ã –ø–æ –º–æ–¥—É–ª—è–º
  - –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π
  - –í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π
  - –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- ‚ùå –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:
  - CSV/Excel —ç–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  - –≠–∫—Å–ø–æ—Ä—Ç —Å–¥–∞—á —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
  - –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –º–æ–¥—É–ª—è–º
- ‚ùå –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:
  - –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  - –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π
  - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–¥–ª—è –ø–∏–ª–æ—Ç–∞):**
- –ë–∞–∑–æ–≤—ã–µ —Å–≤–æ–¥–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –≤ TMA –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤
- –ü—Ä–æ—Å—Ç–æ–π —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–¥–ª—è production):**
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤

---

## üîß –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ NestJS Logger
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ try-catch –±–ª–æ–∫–∞—Ö
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå Health-check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (`/health`, `/status`)
- ‚ùå –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥:
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∞–º–∏
  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –æ—à–∏–±–æ–∫
  - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - Unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
  - E2E —Ç–µ—Å—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
- ‚ùå Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  - –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

**–î–ª—è production-ready –≤–µ—Ä—Å–∏–∏:**
1. Health-check —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î –∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
3. –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ–¥—É–ª—è
   - –°–¥–∞—á–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π
   - –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª–µ–π –∫—É—Ä–∞—Ç–æ—Ä–æ–º
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤ PostgreSQL
5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

---

**–í–µ—Ä—Å–∏—è:** 3.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2024  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** NestJS + React TMA + PostgreSQL
