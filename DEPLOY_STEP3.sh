#!/bin/bash

# –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –®–∞–≥–∞ 3: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π Course
# –û–±–Ω–æ–≤–ª—è–µ—Ç backend –∏ TMA –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Course ‚Üí Module ‚Üí Step

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ: –®–∞–≥ 3 - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π Course"
echo "============================================================"

# 1. –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo ""
echo "üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ Git..."
git pull

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å backend
echo ""
echo "üî® –°–±–æ—Ä–∫–∞ backend..."
cd backend
npm run build

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
echo ""
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend..."
pm2 restart minto-backend

# 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å TMA
echo ""
echo "üé® –°–±–æ—Ä–∫–∞ TMA (frontend)..."
cd ../tma
npm run build

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã
echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤..."
echo ""
echo "Backend (PM2):"
pm2 status

echo ""
echo "üéâ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ TMA –∫–∞–∫ –∫—É—Ä–∞—Ç–æ—Ä"
echo "2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É 'üîß –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä'"
echo "3. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤"
echo "4. –í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å ‚Üí —É–≤–∏–¥–∏—Ç–µ –º–æ–¥—É–ª–∏ —ç—Ç–æ–≥–æ –∫—É—Ä—Å–∞"
echo "5. –ö–Ω–æ–ø–∫–∞ '–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å' —Å–æ–∑–¥–∞—ë—Ç –º–æ–¥—É–ª—å —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫—É—Ä—Å—É"
echo ""
echo "üìö –¢–µ–ø–µ—Ä—å –º–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞!"

