# –ü–æ–ª–∏—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Enrollment –≤ —Å–∏—Å—Ç–µ–º–µ Minto Education

## –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

**Enrollments (–∑–∞–ø–∏—Å–∏ –Ω–∞ –º–æ–¥—É–ª–∏) —Å–æ–∑–¥–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û –∫—É—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç.**

–ù–∏–∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞—Ç—å Enrollment

### –≠–Ω–¥–ø–æ–∏–Ω—Ç: `POST /admin/modules/:moduleId/unlock`

**–î–æ—Å—Ç—É–ø:** —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–æ–ª–µ–π `CURATOR` –∏ `ADMIN`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
{
  userIds?: string[];              // –°–ø–∏—Å–æ–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  allCompletedPrevious?: boolean;  // –§–ª–∞–≥ "–≤—Å–µ, –∫—Ç–æ –∑–∞–≤–µ—Ä—à–∏–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å"
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –ï—Å–ª–∏ `allCompletedPrevious = true`:
   - –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –º–æ–¥—É–ª—è (index=1): –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ–º LEARNER
   - –î–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–º, –∫—Ç–æ –∑–∞–≤–µ—Ä—à–∏–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å (status=COMPLETED)
2. –ï—Å–ª–∏ `userIds` —É–∫–∞–∑–∞–Ω—ã: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥—É–ª—å —Ç–æ–ª—å–∫–æ —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
3. –°–æ–∑–¥–∞—ë—Ç `Enrollment` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `IN_PROGRESS`
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/src/course/course.service.ts` ‚Üí `unlockModuleForUsers()`

---

## –°—Ç–∞—Ç—É—Å—ã –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è

### GET `/course/modules` (–¥–ª—è LEARNER)

–ú–æ–¥—É–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º –∏–∑ —Ç—Ä—ë—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:

1. **LOCKED** (üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω):
   - –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ù–ï–¢ Enrollment –¥–ª—è —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è
   - –ú–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
   - –ñ–¥—ë–º –æ—Ç–∫—Ä—ã—Ç–∏—è –∫—É—Ä–∞—Ç–æ—Ä–æ–º

2. **IN_PROGRESS** (üîì –í –ø—Ä–æ—Ü–µ—Å—Å–µ):
   - –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ï–°–¢–¨ Enrollment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `IN_PROGRESS`
   - –ú–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
   - –ú–æ–∂–Ω–æ —Å–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è

3. **COMPLETED** (‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω):
   - –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ï–°–¢–¨ Enrollment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `COMPLETED`
   - –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (isRequired=true) –æ–¥–æ–±—Ä–µ–Ω—ã –∫—É—Ä–∞—Ç–æ—Ä–æ–º
   - –ú–æ–¥—É–ª—å –∑–∞–≤–µ—Ä—à—ë–Ω, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

---

## –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–¥–µ

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–¥–∞—á–∏ (Submission):

**–§–∞–π–ª:** `backend/src/submissions/submissions.service.ts` ‚Üí `create()`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 61-70):**
```typescript
const enrollment = await this.prisma.enrollment.findFirst({
  where: {
    userId: data.userId,
    moduleId: data.moduleId,
  },
});

if (!enrollment || enrollment.status !== 'IN_PROGRESS') {
  throw new ForbiddenException('Module is not available. Please wait for curator to unlock it.');
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ enrollment –Ω–µ—Ç ‚Üí –æ—à–∏–±–∫–∞ `403 Forbidden`
- –ï—Å–ª–∏ enrollment.status !== 'IN_PROGRESS' ‚Üí –æ—à–∏–±–∫–∞ `403 Forbidden`
- –°–¥–∞—á–∞ –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## –ú–µ—Å—Ç–∞, –≥–¥–µ –ù–ï–¢ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è Enrollment

‚úÖ **AuthService** (`backend/src/auth/auth.service.ts`):
- –°–æ–∑–¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ User –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Telegram WebApp
- –ù–ï —Å–æ–∑–¥–∞—ë—Ç Enrollment

‚úÖ **TelegramService** (`backend/src/telegram/telegram.service.ts`):
- –°–æ–∑–¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ User –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `/start`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ù–ï —Å–æ–∑–¥–∞—ë—Ç Enrollment

‚úÖ **UsersService** (`backend/src/users/users.service.ts`):
- –¢–æ–ª—å–∫–æ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å User
- –ù–ï —Å–æ–∑–¥–∞—ë—Ç Enrollment

‚úÖ **Seed script** (`backend/prisma/seed.ts`):
- –°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–†–æ—Å—Ç–∏—Å–ª–∞–≤, –≠–¥—É–∞—Ä–¥)
- –°–æ–∑–¥–∞—ë—Ç –º–æ–¥—É–ª–∏ –∏ —à–∞–≥–∏ –∫—É—Ä—Å–∞
- –ù–ï —Å–æ–∑–¥–∞—ë—Ç Enrollment (–∫—É—Ä–∞—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª–∏ –≤—Ä—É—á–Ω—É—é)

---

## –õ–æ–≥–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ"

### GET `/course/current`

**–§–∞–π–ª:** `backend/src/course/course.service.ts` ‚Üí `getCurrentModule()`

**–õ–æ–≥–∏–∫–∞:**
1. –ò—â–µ—Ç –ø–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `IN_PROGRESS`
2. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ
3. –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –º–æ–¥—É–ª–µ–π ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π" (–∂–¥—ë—Ç –∫—É—Ä–∞—Ç–æ—Ä–∞)
- –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–π –º–æ–¥—É–ª—å ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ"

---

## Workflow –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```mermaid
graph TD
    A[–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[/start –≤ Telegram]
    B --> C[–°–æ–∑–¥–∞—ë—Ç—Å—è User]
    C --> D[–î–∏–∞–ª–æ–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏]
    D --> E[profileCompleted = true]
    E --> F[–û—Ç–∫—Ä—ã–≤–∞–µ—Ç TMA]
    F --> G[–í–∏–¥–∏—Ç LOCKED –º–æ–¥—É–ª–∏]
    G --> H[–ñ–¥—ë—Ç –∫—É—Ä–∞—Ç–æ—Ä–∞]
    
    I[–ö—É—Ä–∞—Ç–æ—Ä] --> J[POST /admin/modules/1/unlock]
    J --> K[–°–æ–∑–¥–∞—ë—Ç—Å—è Enrollment]
    K --> L[–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é]
    L --> M[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç IN_PROGRESS]
    M --> N[–ú–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ]
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ö—É—Ä–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å –≤—Å–µ–º –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:

**–ó–∞–ø—Ä–æ—Å:**
```bash
POST /admin/modules/:moduleId1/unlock
{
  "allCompletedPrevious": true
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å (index=1) –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–º LEARNER
- –ö–∞–∂–¥—ã–π –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

### 2. –ö—É—Ä–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—Ç–æ—Ä–æ–π –º–æ–¥—É–ª—å —Ç–µ–º, –∫—Ç–æ –∑–∞–≤–µ—Ä—à–∏–ª –ø–µ—Ä–≤—ã–π:

**–ó–∞–ø—Ä–æ—Å:**
```bash
POST /admin/modules/:moduleId2/unlock
{
  "allCompletedPrevious": true
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Ç–æ—Ä–æ–π –º–æ–¥—É–ª—å (index=2) –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–º, —É –∫–æ–≥–æ:
  - –ï—Å—Ç—å `Enrollment` –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –º–æ–¥—É–ª—è
  - –°—Ç–∞—Ç—É—Å –ø–µ—Ä–≤–æ–≥–æ –º–æ–¥—É–ª—è = `COMPLETED`

### 3. –ö—É—Ä–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥—É–ª—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:

**–ó–∞–ø—Ä–æ—Å:**
```bash
POST /admin/modules/:moduleId2/unlock
{
  "userIds": ["userId1", "userId2", "userId3"]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ–ª—å–∑—è —Å–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ –±–µ–∑ Enrollment:**
   - –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å Submission –±–µ–∑ Enrollment ‚Üí –æ—à–∏–±–∫–∞ `403 Forbidden`
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "Module is not available. Please wait for curator to unlock it."

2. **–ú–æ–¥—É–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ TMA, –Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ –∫—É—Ä—Å–∞
   - –ù–æ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å —Ç–µ–º–∏, –≥–¥–µ –µ—Å—Ç—å Enrollment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `IN_PROGRESS`

3. **–ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–æ–¥—É–ª—è:**
   - –ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `COMPLETED` –∫–æ–≥–¥–∞:
     - –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ (isRequired=true) –∏–º–µ—é—Ç Submission —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `CURATOR_APPROVED`
   - –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `getModulesWithProgress` (—Å—Ç—Ä–æ–∫–∏ 82-100)

4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥—É–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å —É—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"

---

## –†–µ–∑—é–º–µ

**‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
- Enrollments —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä–æ–º
- –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç LOCKED –º–æ–¥—É–ª–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –º–æ–¥—É–ª—è

**‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (—ç—Ç–æ–≥–æ –ù–ï–¢ –≤ –∫–æ–¥–µ):**
- ~~–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–≤–æ–≥–æ –º–æ–¥—É–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏~~
- ~~–°–æ–∑–¥–∞–Ω–∏–µ Enrollment –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ TMA~~
- ~~–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–æ–¥—É–ª—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ~~

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-29  
**–í–µ—Ä—Å–∏—è:** 1.0

